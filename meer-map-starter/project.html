<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEER Project Details</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ✅ Banner Header (matches your map banner style idea) -->
  <header class="site-header site-header--banner" aria-label="MEER project header banner">
    <!-- IMPORTANT: update this path if your image is named differently -->
    <img
      src="assets/images/meer-banner-img.png"
      alt="Earth from space with sunlight"
      class="site-header-img"
    />
    <div class="site-header-overlay">
      <!-- ✅ This will be replaced by the selected project's name -->
      <h1 id="projectHeroTitle">MEER Project</h1>
      <p class="subtitle">Gallery, media, and details for this project site.</p>
    </div>
  </header>

  <main class="proj-wrap">
    <h2 id="projectName" class="proj-header"></h2>
    <div id="projectMeta" class="proj-meta"></div>

    <div id="projectBadges" class="proj-badges"></div>

    <section class="section">
      <h3>Overview</h3>
      <div id="projectBody" class="proj-body"></div>
    </section>

    <section class="section">
      <h3>Gallery</h3>
      <div id="projectGallery" class="gallery"></div>
    </section>

    <section class="section">
      <h3>Video & Media</h3>
      <div id="projectVideos" class="video-grid"></div>
    </section>

    <section class="section">
      <h3>Partners & Contacts</h3>
      <div id="projectPartners" class="proj-body"></div>
    </section>

    <a href="index.html" class="button" style="margin-top:16px;">Back to Map</a>
  </main>

  <script>
    const DATA_URL = 'data/projects.json';

    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    function esc(s) {
      return String(s ?? '').replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));
    }

    function render(p) {
      const name = p.name || 'MEER Project';

      // ✅ Set both the hero banner title and the page title section
      document.getElementById('projectHeroTitle').textContent = name;
      document.getElementById('projectName').textContent = name;

      const location = [p.city, p.country].filter(Boolean).join(', ');
      document.getElementById('projectMeta').textContent =
        [location, p.type, p.status].filter(Boolean).join(' · ');

      // badges
      const badges = [];
      if (p.program) badges.push(`<span class="proj-badge">${esc(p.program)} Programme</span>`);
      if (p.role) badges.push(`<span class="proj-badge">${esc(p.role)}</span>`);
      if (p.status) badges.push(`<span class="proj-badge">${esc(p.status)}</span>`);
      document.getElementById('projectBadges').innerHTML = badges.join(' ');

      // overview body
      const focus = p.details || p.focus || p.description || '';
      const years = [
        p.year_started ? `Started: ${esc(p.year_started)}` : '',
        p.last_updated ? `Last updated: ${esc(p.last_updated)}` : ''
      ].filter(Boolean).join(' · ');

      document.getElementById('projectBody').innerHTML = `
        ${focus ? `<p>${esc(focus)}</p>` : `<p>No overview text yet.</p>`}
        ${years ? `<p class="proj-meta">${years}</p>` : ``}
        ${p.notes ? `<p><strong>Notes:</strong> ${esc(p.notes)}</p>` : ``}
      `;

      // gallery
      const imgs = Array.isArray(p.images) ? p.images : [];
      const galleryEl = document.getElementById('projectGallery');
      galleryEl.innerHTML = imgs.length
        ? imgs.map(src => `<img src="${esc(src)}" alt="${esc(p.name)}" class="gallery-img" loading="lazy">`).join('')
        : `<p>No images available yet for this site.</p>`;

      // videos (support both older "video" string and new "videos" array)
      const vids = Array.isArray(p.videos) ? p.videos : (p.video ? [p.video] : []);
      const videosEl = document.getElementById('projectVideos');

      videosEl.innerHTML = vids.length
        ? vids.map(v => {
            const isYouTube = v.includes('youtube.com') || v.includes('youtu.be');
            const isMP4 = v.toLowerCase().endsWith('.mp4');

            if (isYouTube) {
              return `
                <div class="video-card">
                  <iframe
                    src="${esc(v)}"
                    title="Project video"
                    loading="lazy"
                    allowfullscreen>
                  </iframe>
                </div>
              `;
            }

            if (isMP4) {
              return `
                <div class="video-card">
                  <video controls preload="metadata">
                    <source src="${esc(v)}" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>
                </div>
              `;
            }

            return '';
          }).join('')
        : `<p>No video has been added yet.</p>`;

      // partners/contacts
      const partnerLines = [];
      if (p.partners) partnerLines.push(`<p><strong>Partners:</strong> ${esc(p.partners)}</p>`);
      if (p.contact) partnerLines.push(`<p><strong>Local contact:</strong> ${esc(p.contact)}</p>`);
      if (p.link) partnerLines.push(`<p><strong>View more on our website:</strong> <a href="${esc(p.link)}">${esc(p.link)}</a></p>`);
      document.getElementById('projectPartners').innerHTML =
        partnerLines.length ? partnerLines.join('') : `<p>Partner and contact info will be added soon.</p>`;
    }

    if (!id) {
      alert('No project selected.');
      window.location.href = 'index.html';
    } else {
      fetch(DATA_URL)
        .then(r => r.json())
        .then(data => {
          const p = data.find(x => x.id === id);
          if (!p) {
            alert('Project not found.');
            window.location.href = 'index.html';
            return;
          }
          render(p);
        })
        .catch(err => {
          console.error(err);
          alert('Could not load project data.');
        });
    }
  </script>
</body>
</html>
